
Project: School-Secretary - Endpoints (detailed codebase map)
===========================================================

Purpose
-------
This file is a focused, developer-oriented map of the most important API endpoints, the HTTP methods they expose, which view/viewset implements them and where to find that code. It is intentionally concise and different from the `README.md` (do not modify the README per current instruction).

Top-level notes
---------------
- API root prefix: /api/
- The project uses DRF ViewSets with DefaultRouter in each app. Most routes are registered in `api/{app}/urls.py`.
- Auth: JWT via `rest_framework_simplejwt` (token/refresh endpoints in `api/users/urls.py`).
- Roles mentioned in code: STUDENT, GUARDIAN, PROFESSOR, STAFF, SUPERUSER.

Where to look in the code
-------------------------
- Users token endpoints: `api/users/urls.py` -> `CustomTokenObtainPairView`, `CustomTokenRefreshView` and `UserViewSet` (router).
- Students app routes: `api/students/urls.py` (registers StudentViewSet, GradeViewSet, PresenceViewSet, TuitionViewSet, etc.)
- School app routes: `api/school/urls.py` (registers Group, Event, Resource, Room, Notification viewsets).
- Views: `api/students/views.py`, `api/school/views.py`, `api/users/views.py` contain the viewsets and custom actions.

ENDPOINTS (grouped by app) — summary + implementation location
----------------------------------------------------------------

1) Users / Authentication
   Files: `api/users/urls.py`, `api/users/views.py`

   - POST /api/users/token/
     *Purpose*: Obtain access + refresh JWT tokens.
     *Impl*: `CustomTokenObtainPairView` in `api/users/views.py`; route in `api/users/urls.py`.
     *Auth*: public
     *Body*: { "username", "password" }

   - POST /api/users/token/refresh/
     *Purpose*: Refresh access token.
     *Impl*: `CustomTokenRefreshView` in `api/users/views.py`.
     *Auth*: public
     *Body*: { "refresh": "<token>" }

   - /api/users/ (UserViewSet)
     *Purpose*: CRUD users and user profile endpoints. Registered by router in `api/users/urls.py`.
     *Impl*: `UserViewSet` in `api/users/views.py`.

2) Students app
   Files: `api/students/urls.py`, `api/students/views.py`

   Base route: /api/students/
   Registered viewsets and notable actions:

   - StudentViewSet (route: /api/students/)
     *Actions*:
       - GET /api/students/ (list)
       - GET /api/students/{id}/ (retrieve)
       - GET /api/students/{id}/academic-report/  -> `academic_report` action (returns JSON)
         Implementation: `StudentViewSet.academic_report` in `api/students/views.py` (action detail=True)
       - GET /api/students/{id}/download-academic-report/  -> `download_academic_report` (PDF)
       - GET /api/students/{id}/download-grades and download-presence (other PDF actions)
       - GET /api/students/students-needing-attention/  -> `students_needing_attention` (action detail=False)
     *Auth*: permissions vary (IsAuthenticated for read; staff for writes) — see `get_permissions` in view

   - PresenceViewSet (route: /api/students/presences/)
     *Actions*:
       - GET /api/students/presences/absence-report/  -> `absence_report` (identify >25% absences)
       - Standard list/retrieve/create for presence records
     *Impl*: `PresenceViewSet.absence_report` in `api/students/views.py`

   - TuitionViewSet (route: /api/students/tuitions/)
     *Actions*:
       - GET /api/students/tuitions/ (list)
       - GET /api/students/tuitions/payment-history/  -> `payment_history` (query param: student_id optional)
       - GET /api/students/tuitions/financial-report/ -> `financial_report`
       - GET /api/students/tuitions/download-financial-report/ -> `download_financial_report` (PDF)
     *Auth*: list/retrieve typically IsAuthenticated; other actions often restricted to staff (see view)

   - Other registered viewsets in students: `grades`, `guardians`, `contracts`, `warnings`, `suspensions`, `enrollments` — see `api/students/urls.py` for exact router mappings.

3) School app (groups, events, resources, rooms, notifications)
   Files: `api/school/urls.py`, `api/school/views.py`

   Base route: /api/school/
   Registered viewsets and important actions:

   - GroupViewSet (route: /api/school/groups/)
     *Actions*:
       - GET /api/school/groups/{id}/get-lessons/ -> `get_lessons` (detail action)
       - GET /api/school/groups/{id}/performance-report/ -> `performance_report`
     *Impl*: `GroupViewSet` in `api/school/views.py`

   - EventViewSet (route: /api/school/events/)
     *Actions*:
       - POST /api/school/events/{id}/register/ -> `register` (register a student for an event)
       - Standard CRUD for events
     *Impl*: `EventViewSet.register` in `api/school/views.py`

   - EventRegistrationViewSet (route: /api/school/event-registrations/)
     *Purpose*: manage event signup records (staff/owner access control)

   - ResourceViewSet, ResourceLoanViewSet (routes: /api/school/resources/, /api/school/resource-loans/)
     *Actions*: list, create loan, patch/return loan

   - RoomViewSet, RoomReservationViewSet (routes: /api/school/rooms/, /api/school/room-reservations/)
     *Actions*: availability, reserve room

   - NotificationViewSet (route: /api/school/notifications/)
     *Actions*: list, mark read (custom action implemented in viewset)

4) Admin and static
   - Django admin site: /api/admin/  (configured in `api/School-Secretary/urls.py` as `admin/`)
   - Health checks: frontend has `/healthcheck` and API healthcheck script `api/healthcheck.py` used by compose

5) Frontend <-> API wiring (who uses which routes)
   Files: `app/src/config.ts`, `app/src/services/api.ts`
   - ROUTES / ROUTES_INTERNAL constants define the relative paths used by the frontend.
   - Ensure env vars are set for NEXT_PUBLIC_PUBLIC_API_HOST / NEXT_PUBLIC_PRIVATE_API_HOST to point to `/api/` or internal `http://api:8000/api/` when running via compose.

Quick lookups
-------------
- To list all registered API routes, inspect `api/*/urls.py` files (students, school, users).
- To find custom actions, search for `@action(` in `api/*/views.py`.

Commands that help developers
----------------------------
- Find custom actions quickly:
  grep -R "@action(" -n api | sed -n '1,200p'
- List routers / urls files:
  sed -n '1,240p' api/students/urls.py
  sed -n '1,240p' api/school/urls.py
  sed -n '1,240p' api/users/urls.py

Closing notes
-------------
- I will not modify `README.md`. This file provides an orthogonal, compact developer map for endpoints. If you want, I can now:
  - Expand every endpoint with request/response examples and the exact view/file line numbers.
  - Produce a CSV list of endpoints for quick import into API tooling.

End of file.


Per-file mapping (file -> function)
-----------------------------------
Below are the primary files and the notable viewset action functions implemented in each. This lists only the file and function name (no full source) for quick navigation.

- api/users/views.py
  - UserViewSet.me
  - CustomTokenObtainPairView (TokenObtainPairView subclass)
  - CustomTokenRefreshView (TokenRefreshView subclass)

- api/students/views.py
  - StudentViewSet.download_grades_pdf
  - StudentViewSet.download_presence_pdf
  - StudentViewSet.academic_report
  - StudentViewSet.download_academic_report
  - StudentViewSet.students_needing_attention
  - ContractViewSet.download_contract_pdf
  - PresenceViewSet.absence_report
  - TuitionViewSet.payment_history
  - TuitionViewSet.financial_report
  - TuitionViewSet.download_financial_report

- api/students/urls.py
  - router.register: StudentViewSet, GradeViewSet, GuardianViewSet, ContractViewSet, PresenceViewSet,
    WarningViewSet, SuspensionViewSet, TuitionViewSet, EnrollmentViewSet

- api/school/views.py
  - GroupViewSet.get_lessons
  - GroupViewSet.performance_report
  - AgendaItemViewSet.get_pendents
  - EventViewSet.get_pendents
  - EventViewSet.register
  - NotificationViewSet.mark_read
  - NotificationViewSet.mark_all_read
  - ResourceViewSet (standard actions)
  - ResourceLoanViewSet (standard actions)
  - RoomReservationViewSet (standard actions)

- api/school/urls.py
  - router.register: ProfessorViewSet, SubjectViewSet, ItineraryViewSet, GroupViewSet, SchoolRecordViewSet,
    BookViewSet, LessonViewSet, AgendaItemViewSet, EventViewSet, EventRegistrationViewSet, ResourceViewSet,
    ResourceLoanViewSet, RoomViewSet, RoomReservationViewSet, NotificationViewSet

- api/healthcheck.py
  - simple health probe script (requests `/api/admin/login/` and exits 0/1)


End of file2.

